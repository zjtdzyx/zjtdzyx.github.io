
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{d as M,P as R,Q as S,r as v,D as j,z as G,a as c,o as d,k as b,e as a,w as n,c as C,t as g,g as B,E as f,R as I}from"./index-B_i3AGOe.js";const P=["onClick"],Q=["onClick"],q=["onClick"],H=["onClick"],J=["onClick"],W=M({__name:"farmer_info",setup(K){const $=R.create({baseURL:"/",timeout:6e4,responseType:"json"}),u=S({farmerNumber:"",name:"",address:"",contact:"",sowingArea:""}),w=v([]),x=v(!1),N=v(null),V=v(""),A=j(()=>V.value?w.value.filter(o=>o.name.toLowerCase().includes(V.value.toLowerCase())||o.farmerNumber.toLowerCase().includes(V.value.toLowerCase())):w.value);async function h(){x.value=!0,N.value=null;try{const o=await $.get("/farmers");w.value=o.data}catch(o){N.value=o.message||"Failed to fetch data"}finally{x.value=!1}}G(()=>{h()});async function D(){try{const o=await $.post("/farmers",u);f.success("提交成功")}catch(o){N.value=o.message||"Failed to submit data",f.error("提交失败")}finally{x.value=!1}}const s=v(null),m=v("");function z(o,l){s.value===o?(s.value=null,m.value=""):(s.value=o,m.value="farmerNumber")}function k(o,l){s.value===o&&(m.value=l)}async function y(o){try{const l=w.value[o],r={farmerNumber:l.farmerNumber,name:l.name,address:l.address,contact:l.contact,sowingArea:l.sowingArea};(await $.put(`/farmers/${r.farmerNumber}`,r)).status===200?h():f.error("更新失败")}catch{f.error("请求更新失败"),s.value=null,m.value=""}}async function E(o,l){try{await I.confirm(`确定要删除农户 ${l.name} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})&&((await $.delete(`/farmers/${l.farmerNumber}`)).status===204?(w.value.splice(o,1),f.success(`农户 ${l.name} 删除成功`)):f.error("删除失败"))}catch{f.error("删除失败")}}return(o,l)=>{const r=c("el-input"),i=c("el-table-column"),U=c("el-button"),T=c("el-table"),p=c("el-form-item"),_=c("el-option"),L=c("el-select"),F=c("el-form");return d(),b("div",null,[a(T,{data:A.value,style:{width:"100%"}},{default:n(()=>[a(i,{label:"农户编号",prop:"farmerNumber"},{default:n(e=>[s.value===e.$index&&m.value==="farmerNumber"?(d(),C(r,{key:0,modelValue:e.row.farmerNumber,"onUpdate:modelValue":t=>e.row.farmerNumber=t,size:"small",placeholder:"请输入农户编号",onBlur:y},null,8,["modelValue","onUpdate:modelValue"])):(d(),b("span",{key:1,onClick:t=>k(e.$index,"farmerNumber")},g(e.row.farmerNumber),9,P))]),_:1}),a(i,{label:"农户名称",prop:"name"},{default:n(e=>[s.value===e.$index&&m.value==="name"?(d(),C(r,{key:0,modelValue:e.row.name,"onUpdate:modelValue":t=>e.row.name=t,size:"small",placeholder:"请输入农户名称",onBlur:y},null,8,["modelValue","onUpdate:modelValue"])):(d(),b("span",{key:1,onClick:t=>k(e.$index,"name")},g(e.row.name),9,Q))]),_:1}),a(i,{label:"农户住址",prop:"address"},{default:n(e=>[s.value===e.$index&&m.value==="address"?(d(),C(r,{key:0,modelValue:e.row.address,"onUpdate:modelValue":t=>e.row.address=t,size:"small",placeholder:"请输入农户住址",onBlur:y},null,8,["modelValue","onUpdate:modelValue"])):(d(),b("span",{key:1,onClick:t=>k(e.$index,"address")},g(e.row.address),9,q))]),_:1}),a(i,{label:"联系电话",prop:"contact"},{default:n(e=>[s.value===e.$index&&m.value==="contact"?(d(),C(r,{key:0,modelValue:e.row.contact,"onUpdate:modelValue":t=>e.row.contact=t,size:"small",placeholder:"请输入联系电话",onBlur:y},null,8,["modelValue","onUpdate:modelValue"])):(d(),b("span",{key:1,onClick:t=>k(e.$index,"contact")},g(e.row.contact),9,H))]),_:1}),a(i,{label:"播种面积",prop:"sowingArea"},{default:n(e=>[s.value===e.$index&&m.value==="sowingArea"?(d(),C(r,{key:0,modelValue:e.row.sowingArea,"onUpdate:modelValue":t=>e.row.sowingArea=t,size:"small",placeholder:"请输入播种面积",onBlur:y},null,8,["modelValue","onUpdate:modelValue"])):(d(),b("span",{key:1,onClick:t=>k(e.$index,"sowingArea")},g(e.row.sowingArea),9,J))]),_:1}),a(i,{align:"right"},{header:n(()=>[a(r,{modelValue:V.value,"onUpdate:modelValue":l[0]||(l[0]=e=>V.value=e),size:"small",placeholder:"Type to search"},null,8,["modelValue"])]),default:n(e=>[a(U,{size:"small",onClick:t=>z(e.$index,e.row)},{default:n(()=>l[6]||(l[6]=[B(" 编辑 ")])),_:2},1032,["onClick"]),a(U,{size:"small",type:"danger",onClick:t=>E(e.$index,e.row)},{default:n(()=>l[7]||(l[7]=[B(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),a(F,{model:u,"label-width":"100",style:{"max-width":"600px"}},{default:n(()=>[a(p,{label:"农户编号"},{default:n(()=>[a(r,{modelValue:u.farmerNumber,"onUpdate:modelValue":l[1]||(l[1]=e=>u.farmerNumber=e)},null,8,["modelValue"])]),_:1}),a(p,{label:"农户姓名"},{default:n(()=>[a(r,{modelValue:u.name,"onUpdate:modelValue":l[2]||(l[2]=e=>u.name=e)},null,8,["modelValue"])]),_:1}),a(p,{label:"农户住址"},{default:n(()=>[a(L,{modelValue:u.address,"onUpdate:modelValue":l[3]||(l[3]=e=>u.address=e),placeholder:"请选择所在村"},{default:n(()=>[a(_,{label:"A村",value:"A村"}),a(_,{label:"B村",value:"B村"}),a(_,{label:"C村",value:"C村"}),a(_,{label:"D村",value:"D村"}),a(_,{label:"E村",value:"E村"}),a(_,{label:"F村",value:"F村"})]),_:1},8,["modelValue"])]),_:1}),a(p,{label:"联系方式"},{default:n(()=>[a(r,{modelValue:u.contact,"onUpdate:modelValue":l[4]||(l[4]=e=>u.contact=e)},null,8,["modelValue"])]),_:1}),a(p,{label:"种植面积"},{default:n(()=>[a(r,{modelValue:u.sowingArea,"onUpdate:modelValue":l[5]||(l[5]=e=>u.sowingArea=e)},null,8,["modelValue"])]),_:1}),a(p,null,{default:n(()=>[a(U,{type:"primary",onClick:D},{default:n(()=>l[8]||(l[8]=[B(" 提交 ")])),_:1})]),_:1})]),_:1},8,["model"])])}}});export{W as default};
