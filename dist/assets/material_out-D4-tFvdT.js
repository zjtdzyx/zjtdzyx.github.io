
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{d as h,P as g,r as u,Q as V,z as B,a as o,o as T,k as C,e as a,w as r,g as k,F,R as p}from"./index-COvaATLK.js";const O=h({__name:"material_out",setup(K){const d=g.create({baseURL:"/",timeout:6e4,responseType:"json"}),s=u([]),l=V({materialNumber:"",quantity:""}),f=u(!1),i=u(null),N=u(null);async function _(){f.value=!0,i.value=null;try{const e=await d.get("/materials");s.value=e.data}catch(e){i.value=e.message||"Failed to fetch data"}finally{f.value=!1}}B(()=>{_()});function b(){const e=s.value.find(t=>t.materialNumber===l.materialNumber);return e?e.quantity=Number(l.quantity):l.quantity="",e}async function q(){const e=b();if(!e){p.alert("物资编号无效，请重新输入！","错误",{confirmButtonText:"OK",type:"error"});return}const t=Number(l.quantity);if(t<=0||t>e.quantity){p.alert("非法的出库数量，请检查后重新输入！","错误",{confirmButtonText:"OK",type:"error"});return}try{e.quantity-=t;const n=await d.put(`/materials/${e.materialNumber}`,e);N.value=n.data,_(),p.alert("物资出库成功！","成功",{confirmButtonText:"OK",type:"success"})}catch(n){i.value=n.message||"Failed to update data"}}return(e,t)=>{const n=o("el-table-column"),v=o("el-table"),y=o("el-input"),m=o("el-form-item"),w=o("el-button"),x=o("el-form");return T(),C(F,null,[a(v,{data:s.value,height:"250",style:{width:"100%"}},{default:r(()=>[a(n,{prop:"materialNumber",label:"物资编号",width:"180"}),a(n,{prop:"name",label:"名称",width:"180"}),a(n,{prop:"unit",label:"单位",width:"180"}),a(n,{prop:"quantity",label:"数量",width:"180"})]),_:1},8,["data"]),a(x,{model:l,"label-width":"100",style:{"max-width":"600px"}},{default:r(()=>[a(m,{label:"产品编号"},{default:r(()=>[a(y,{modelValue:l.materialNumber,"onUpdate:modelValue":t[0]||(t[0]=c=>l.materialNumber=c),onInput:b},null,8,["modelValue"])]),_:1}),a(m,{label:"出库数量"},{default:r(()=>[a(y,{modelValue:l.quantity,"onUpdate:modelValue":t[1]||(t[1]=c=>l.quantity=c),type:"number"},null,8,["modelValue"])]),_:1}),a(m,null,{default:r(()=>[a(w,{type:"primary",onClick:q},{default:r(()=>t[2]||(t[2]=[k(" 提交 ")])),_:1})]),_:1})]),_:1},8,["model"])],64)}}});export{O as default};
