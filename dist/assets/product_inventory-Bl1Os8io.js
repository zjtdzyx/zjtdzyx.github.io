
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{d as D,P as B,r as m,z as H,S as M,a as d,o as S,k as T,b as f,e as o,w as n,g as s,t as z,x as E}from"./index-B_i3AGOe.js";const L={class:"container"},N={class:"product-info"},j={class:"mb-4"},P={class:"dialog-footer"},R=D({__name:"product_inventory",setup($){const c=B.create({baseURL:"/",timeout:6e4,responseType:"json"}),t=m({auditedCount:0,systemCount:0,difference:0,inbound_date:new Date}),y=m([]),C=m(0),r=m(!1),a=m(null);function v(){const u=window.innerHeight;C.value=u-200}H(()=>{v(),window.addEventListener("resize",v),w()}),M(()=>{window.removeEventListener("resize",v)});async function w(){try{const u=await c.get("/api/products");y.value=u.data}catch(u){console.error("获取数据失败:",u)}}function g(){a.value&&(t.value.auditedCount=a.value.auditedCount||0,t.value.systemCount=a.value.systemCount||0,t.value.difference=0,t.value.inbound_date=new Date,r.value=!0)}async function V(){if(a.value){t.value.difference=(t.value.systemCount||0)-(t.value.auditedCount||0);try{await c.put(`/api/products/${a.value.product_number}`,{auditedCount:t.value.auditedCount,systemCount:t.value.systemCount,difference:t.value.difference,last_inbound_date:t.value.inbound_date}),Object.assign(a.value,{auditedCount:t.value.auditedCount,systemCount:t.value.systemCount,difference:t.value.difference,last_inbound_date:t.value.inbound_date}),w(),r.value=!1}catch(u){console.error("更新数据失败:",u)}}}return(u,e)=>{const b=d("el-button"),i=d("el-table-column"),k=d("el-table"),x=d("el-date-picker"),_=d("el-input"),p=d("el-form-item"),U=d("el-form"),h=d("el-dialog");return S(),T("div",L,[f("div",N,[e[8]||(e[8]=f("h2",null,"产品盘存",-1)),f("div",j,[o(b,{type:"primary",plain:"",disabled:!a.value,onClick:g},{default:n(()=>e[7]||(e[7]=[s(" 盘点结果录入（先点击勾选产品） ")])),_:1},8,["disabled"])])]),o(k,{data:y.value,height:C.value,border:"",style:{width:"100%"},onRowClick:e[0]||(e[0]=l=>a.value=l)},{default:n(()=>[o(i,{type:"selection",width:"55"}),o(i,{label:"产品编号",width:"100",align:"center"},{default:n(l=>[s(z(l.row.product_number),1)]),_:1}),o(i,{property:"name",label:"产品名称",width:"120",align:"center"}),o(i,{property:"last_inbound_date",label:"最后入库日期",width:"180",align:"center"}),o(i,{property:"auditedCount",label:"更新前数量",width:"100",align:"center"}),e[9]||(e[9]=s()),o(i,{property:"systemCount",label:"更新后数量",width:"100",align:"center"}),e[10]||(e[10]=s()),o(i,{property:"difference",label:"'数量变化差异",width:"120",align:"center"})]),_:1},8,["data","height"]),o(h,{modelValue:r.value,"onUpdate:modelValue":e[6]||(e[6]=l=>r.value=l),title:"盘存结果录入",width:"400px"},{footer:n(()=>[f("div",P,[o(b,{onClick:e[5]||(e[5]=l=>r.value=!1)},{default:n(()=>e[11]||(e[11]=[s(" 取消 ")])),_:1}),o(b,{type:"primary",onClick:V},{default:n(()=>e[12]||(e[12]=[s(" 确认 ")])),_:1})])]),default:n(()=>[o(U,{model:t.value,"label-width":"100px"},{default:n(()=>[o(p,{label:"最后入库日期"},{default:n(()=>[o(x,{modelValue:t.value.inbound_date,"onUpdate:modelValue":e[1]||(e[1]=l=>t.value.inbound_date=l),type:"date",placeholder:"选择日期",style:{width:"100%"}},null,8,["modelValue"]),o(p,{label:"更新前数量"},{default:n(()=>[o(_,{modelValue:t.value.auditedCount,"onUpdate:modelValue":e[2]||(e[2]=l=>t.value.auditedCount=l),modelModifiers:{number:!0},type:"number",min:"1"},null,8,["modelValue"])]),_:1}),o(p,{label:"更新后数量"},{default:n(()=>[o(_,{modelValue:t.value.systemCount,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.systemCount=l),modelModifiers:{number:!0},type:"number",min:"1"},null,8,["modelValue"])]),_:1}),o(p,{label:"数量变化差异"},{default:n(()=>[o(_,{modelValue:t.value.difference,"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.difference=l),modelModifiers:{number:!0},type:"number",min:"1"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),I=E(R,[["__scopeId","data-v-343be4a6"]]);export{I as default};
